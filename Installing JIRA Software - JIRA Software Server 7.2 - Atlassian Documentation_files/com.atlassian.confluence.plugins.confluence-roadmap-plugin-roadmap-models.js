;try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-roadmap-plugin:roadmap-models', location = '/models/model.js' */
(function(){window.Roadmap=window.Roadmap||{};Roadmap.Bar=Backbone.Model.extend({defaults:function(){return{id:Confluence.Roadmap.Helper.guid(),title:"New Bar",description:"",startDate:new Date(),duration:1,rowIndex:0,pageLink:{}}}});Roadmap.Lane=Backbone.Model.extend({defaults:function(){return{title:"New Lane",color:Confluence.Roadmap.ColorHelper.getColor(),bars:[]}},initialize:function(){var a=new Roadmap.Bars(this.get("bars"));this.set("bars",a)},getNumberOfRows:function(){var a=this.get("bars");if(a.length===0){return 0}var b=0;a.each(function(c){b=Math.max(c.get("rowIndex"),b)});return b+1}});Roadmap.Marker=Backbone.Model.extend({defaults:function(){return{title:"Marker"}}});Roadmap.Timeline=Backbone.Model.extend({defaults:function(){return{displayOption:Roadmap.TIMELINE_DISPLAY_OPTION.MONTH}},validate:function(a){var d=[];var c=Confluence.Roadmap.DateUtilities.parseDate(a.startDateString);var b=Confluence.Roadmap.DateUtilities.parseDate(a.endDateString);if(!c||!b){d.push({name:"date",message:"Enter dates in yy-mm-dd"})}else{if(c.diff(b)>=0){d.push({name:"endDate",message:"Start date needs to be before the end date"})}else{if(b.diff(c,"years",true)>Roadmap.TIMELINE_YEARS_LIMIT){d.push({name:"endDate",message:AJS.format("You cannot plan more than {0} years ahead.",Roadmap.TIMELINE_YEARS_LIMIT)})}}}return d.length>0?d:false},calculateTimelineColumns:function(){var d=this.get("startDate");var f=this.get("endDate");var c=[];var e;if(this.get("displayOption")===Roadmap.TIMELINE_DISPLAY_OPTION.MONTH){e=moment(d).clone().startOf("month");var b=moment(f).clone().endOf("month");do{c.push({month:Confluence.Roadmap.DateUtilities.getDateStringFromDate(e,Roadmap.MONTH_FORMAT),year:e.get("year")});e.add(1,"months")}while(e.diff(b)<0)}else{e=moment(d).clone().startOf("isoWeek");var a=moment(f).clone().endOf("isoWeek");do{c.push({month:Confluence.Roadmap.DateUtilities.getDateStringFromDate(e,Roadmap.WEEK_FORMAT),year:e.get("year")});e.add(1,"weeks")}while(e.diff(a)<0)}this.attributes.displayTimelineColumns=c}});Roadmap.Roadmap=Backbone.Model.extend({defaults:function(){return{title:"Roadmap Planner",lanes:[],markers:[]}},initialize:function(){var a=new Roadmap.Lanes(this.get("lanes"));this.set("lanes",a);var c=new Roadmap.Markers(this.get("markers"));this.set("markers",c);var b=new Roadmap.Timeline(this.get("timeline"));this.set("timeline",b)},parse:function(a){if(!a.timeline){return Roadmap.getDefaultRoadmapData()}return this.fromMacroData(a)},fromMacroData:function(c){var b=c.timeline;b.startDate=Confluence.Roadmap.DateUtilities.getDateFromDateString(b.startDate);b.endDate=Confluence.Roadmap.DateUtilities.getDateFromDateString(b.endDate);var a=c.lanes;_.each(a,function(e){var f=e.bars;_.each(f,function(g){g.startDate=Confluence.Roadmap.DateUtilities.getDateFromDateString(g.startDate);if(!g.id){g.id=Confluence.Roadmap.Helper.guid()}});e.bars=f});c.lanes=a;var d=c.markers;_.each(d,function(e){e.markerDate=Confluence.Roadmap.DateUtilities.getDateFromDateString(e.markerDate)});c.markers=d;return c},toMacroData:function(){var c=this.toJSON();var b=c.timeline.toJSON();b.startDate=Confluence.Roadmap.DateUtilities.getDateStringFromDate(b.startDate);b.endDate=Confluence.Roadmap.DateUtilities.getDateStringFromDate(b.endDate);delete b.displayTimelineColumns;c.timeline=b;var a=c.lanes.toJSON();_.each(a,function(e){var f=e.bars.toJSON();_.each(f,function(g){g.startDate=Confluence.Roadmap.DateUtilities.getDateStringFromDate(g.startDate)});e.bars=f});c.lanes=a;var d=c.markers.toJSON();_.each(d,function(e){e.markerDate=Confluence.Roadmap.DateUtilities.getDateStringFromDate(e.markerDate)});c.markers=d;return c},updateDurationUnit:function(a){this.get("lanes").each(function(b){b.get("bars").each(function(c){var d;d=a===Roadmap.TIMELINE_DISPLAY_OPTION.MONTH?Confluence.Roadmap.DateUtilities.convertToMonthDuration(c.get("startDate"),c.get("duration")):Confluence.Roadmap.DateUtilities.convertToWeekDuration(c.get("startDate"),c.get("duration"));c.attributes.duration=d})})}})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-roadmap-plugin:roadmap-models', location = '/models/collection.js' */
(function(){window.Roadmap=window.Roadmap||{};Roadmap.Bars=Backbone.Collection.extend({model:Roadmap.Bar});Roadmap.Lanes=Backbone.Collection.extend({model:Roadmap.Lane});Roadmap.Markers=Backbone.Collection.extend({model:Roadmap.Marker})})();
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
