;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-editor-iframe.js' */
AJS.bind("gliffy.init.rte",function(a){(function(c){var d=function(n){var o=[];var k=function(p){o.forEach(function(q){q(p)})};var f=c(window.parent.window);var j=f.get(0).history;if(j&&j.pushState&&Confluence&&Confluence.Editor&&Confluence.Editor.Drafts&&Confluence.Editor.Drafts.unloadMessage){var e=Confluence.Editor.Drafts.unloadMessage;Confluence.Editor.Drafts.unloadMessage=function(){return};var i,m;var g=false,h=false;var l="#GliffyDiagramEdit";j.pushState({},"",l);o.push(function(p){if(p.userCancelled){if(g){j.pushState({},"",l)}}else{if(!g){h=true;j.back()}n.editor.hide();if(g){j.pushState({},"","");i()}}g=false});i=function(){f.off("unload",i);f.off("popstate",m);n.editor.html5Editor.postCloseCallback=null;Confluence.Editor.Drafts.unloadMessage=e};f.on("unload",i);m=function(p){if(!n.editor.hidden){g=true;n.editor.html5Editor.close()}else{if(h){h=false;j.pushState({},"","");i()}}};f.on("popstate",m)}o.push(function(p){AJS.trigger("gliffy.confluence.inlineEditorClosed")});if(n.gonContent){n.editor.html5Editor.open({jsonObj:n.gonContent,dirty:true})}else{if(n.template.category=="com.gliffy.templates.blank"){n.editor.html5Editor.create(null,n.template.panels)}else{if(n.template.category=="com.gliffy.diagram"){if(n.attachmentVersion&&n.attachmentVersion>0){n.editor.html5Editor.open({url:AJS.format("/diagrams/{0}?version={1}",n.attachmentId,n.attachmentVersion)})}else{n.editor.html5Editor.open({url:AJS.format("/diagrams/{0}",n.attachmentId)})}}else{if(n.template.category=="com.gliffy.transform.diagram"){n.editor.html5Editor.open({url:AJS.format("/templates/transform/{0}",n.template.name),dirty:true})}else{n.editor.html5Editor.open({url:AJS.format("/templates/{0}",n.template.name),useShapeStyles:false,dirty:true})}}}}n.editor.show();GLIFFY.confluence.fixEditorFocus();n.editor.html5Editor.postCloseCallback=k};var b=function(f){var f=c.extend({diagramName:null,template:{category:"com.gliffy.templates.blank",name:"com.gliffy.template.blank"},attachmentId:null,panels:null},f);f.editor.loadedCallback=function(){d(f)};var e;if(f.ownerPageId){e=AJS.format("{0}/plugins/gliffy/editor.action?ceoid={1}&inline=true&pageId={2}&attachmentVersion={3}&originalAttachmentVersion={4}&name={5}",AJS.Confluence.getContextPath(),f.ownerPageId,f.referencePageId,f.attachmentVersion||0,f.originalAttachmentVersion||f.attachmentVersion||0,encodeURIComponent(f.diagramName))}else{e=AJS.format("{0}/plugins/gliffy/editor.action?ceoid={1}",AJS.Confluence.getContextPath(),Confluence.Editor.getContentId())}if(!f.editor.obj){c("body").append(c('<div class="gliffy-spinner gliffy-spinner-icon"></div><div class="gliffy-spinner gliffy-spinner-bg"></div>'));f.editor.obj=c("<iframe />",{src:e,id:"gliffy-editor"}).css({position:"absolute",width:"100%",height:"100%",top:0,left:0,border:0}).appendTo("body")}else{f.editor.obj.attr("src",e);d(f)}};AJS.bind("gliffy.confluence.launchInlineEditor",function(f,e){b(e)});AJS.bind("gliffy.confluence.launchEditorWithGonData",function(g,f){try{if(GLIFFY._confluence.macroDialog){GLIFFY._confluence.macroDialog.hide()}}catch(h){console.log("Error hiding Gliffy macro dialog on gliffy.confluence.launchEditorWithGonData: "+h)}b({editor:GLIFFY._confluence.editor,gonContent:f})});AJS.bind("gliffy.confluence.launchTemplate",function(i,h,g,f){try{if(GLIFFY._confluence.macroDialog){GLIFFY._confluence.macroDialog.hide()}}catch(j){console.log("Error hiding Gliffy macro dialog on gliffy.confluence.launchTemplate: "+j)}b({editor:GLIFFY._confluence.editor,template:{category:h,name:g,panels:f}})});AJS.bind("gliffy.confluence.addGliffyDiagramToPage",function(h,g,f){try{if(GLIFFY._confluence.macroDialog){GLIFFY._confluence.macroDialog.hide()}}catch(i){console.log("Error hiding Gliffy macro dialog on gliffy.confluence.addGliffyDiagramToPage: "+i)}var j={contentId:Confluence.Editor.getContentId(),macro:{name:"gliffy",params:{name:f,blueprint:g},defaultParameterValue:"",body:""}};GLIFFY.confluence.insertMacro(j)})}(AJS.$))});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/PromiseJS.js' */
(function(g){var d={Pending:"Pending",Resolved:"Resolved",Rejected:"Rejected"};if(!Array.prototype.forEach){Array.prototype.forEach=function(l,k){for(var j=0,h=this.length;j<h;++j){if(j in this){l.call(k,this[j],j,this)}}}}function e(){var i=this,j=[],h=[],n=[],m=d.Pending,l;function k(){var o=this;o.success=function(p){if(m===d.Resolved){p.call(o,l)}else{j.push(p)}return o};o.fail=function(p){if(m===d.Rejected){p.call(o,l)}else{h.push(p)}return o};o.progress=function(p){n.push(p);return o};o.always=function(p){return o.success(p).fail(p)};o.then=function(q,p){return o.success(q).fail(p)};o.isPending=function(){return m===d.Pending};o.isResolved=function(){return m===d.Resolved};o.isRejected=function(){return m===d.Rejected};o.value=function(){return l}}i.promise=new k();i.resolve=function(o){if(m===d.Pending){m=d.Resolved;l=o;j.forEach(function(p){p.call(i.promise,l)})}};i.reject=function(o){if(m===d.Pending){m=d.Rejected;l=o;h.forEach(function(p){p.call(i.promise,l)})}};i.notify=function(){if(m===d.Pending){n.forEach(function(o){o.call(i.promise)})}}}function b(h){return Object.prototype.toString.call(h)==="[object Array]"}function a(l){var h=b(l)?l:Array.prototype.slice.call(arguments,0),j=h.length,i=0,k=new e();h.forEach(function(m){m.always(function(){i+=1;if(i===j){k.resolve(h)}})});return k.promise}function c(i,h,j){if(i.length===0){h.resolve(j)}else{var k=i[0].call();k.always(function(){c(Array.prototype.slice.call(i,1),h,j.concat([k]))})}}function f(j){var h=b(j)?j:Array.prototype.slice.call(arguments,0),i=new e();if(h.length===0){i.resolve()}else{c(h,i,[])}return i.promise}g.PromiseJS={Deferred:e,when:a,chain:f};if(typeof exports!=="undefined"){exports.PromiseJS=g.PromiseJS}}((function(){return this}.call())));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-rte-utils.js' */
(function(b){var a=setInterval(function(){if(AJS.Rte&&AJS.Rte.getEditor()){clearInterval(a);AJS.trigger("gliffy.init.rte")}},500);AJS.bind("init.rte",function(){clearInterval(a);AJS.trigger("gliffy.init.rte")})}(AJS.$));AJS.bind("gliffy.init.rte",function(a){(function(c){window.GLIFFY=window.GLIFFY||{};GLIFFY._confluence=GLIFFY._confluence||{};GLIFFY._confluence.gvars={gliffyApiEndpoint:AJS.format("{0}/rest/gliffy/1.0",AJS.Confluence.getContextPath()),isAutoSearchOn:true,spaces:[]};GLIFFY._confluence.utils={getMacroParams:function(f){var e={};var d=f.data&&f.data("macro-parameters");d=d||(f.dataset&&f.dataset.macroParameters);if(d){c.each(d.split("|"),function(g,h){var i=h.split("=");e[i[0]]=i[1]})}return e},getUrlVars:function(){var g=[],f;var d=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var e=0;e<d.length;e++){f=d[e].split("=");g.push(f[0]);g[f[0]]=decodeURIComponent(f[1])}return g},parseError:function(g){if(g.responseText!=null){try{var d=c.parseJSON(g.responseText);return(d.message!=null)?d.message:g.responseText}catch(f){return g.responseText}}return""},analyticsEvent:function(e,d){c(window).trigger(e+".gliffyAnalytics",d)},getAnalyticsLabel:function(){return"none"},getAnalyticsProduct:function(){return"Confluence"},getAnalyticsLicense:function(){return c("meta[name=gliffy-license-type]").attr("content")},getAnalyticsNumUsers:function(){return parseInt(c("meta[name=gliffy-license-quantity]").attr("content"))},initAnalytics:function(){var e=GLIFFY._confluence.utils.getAnalyticsLabel(),d;d=new PromiseJS.Deferred();c.ajax({url:AJS.format("{0}/rest/gliffy/1.0/properties/com.gliffy.integration.confluence.ANALYTICS_OFF",Confluence.getContextPath()),type:"GET",cache:false,success:function(f){if(f["com.gliffy.integration.confluence.ANALYTICS_OFF"]!==true){GLIFFY._confluence.utils.analyticsEvent("init",{accountType:"google",accountID:"UA-248648-8",optPageName:"Gliffy Confluence RTE Init"});GLIFFY._confluence.utils.analyticsEvent("setLabel",{label:e});GLIFFY._confluence.utils.analyticsEvent("setCustomVariables",{product:GLIFFY._confluence.utils.getAnalyticsProduct(),license:GLIFFY._confluence.utils.getAnalyticsLicense(),numUsers:(GLIFFY._confluence.utils.getAnalyticsNumUsers()+" Users")})}d.resolve(f)},error:function(h,f,g){AJS.log("Error determining if analytics is available",g);d.reject(h)},dataType:"json"});return d.promise}};var b=function(){var e=function(){if(AJS.Rte.getEditorFrame){c(AJS.Rte.getEditorFrame()).focus()}var h=c("#gliffy-editor")[0];if(h){h.contentWindow.focus()}};var g=tinymce.confluence.NodeUtils.replaceNode;var f=function(n,j){var l=tinymce.confluence.NodeUtils,h=tinymce.activeEditor,m=l.getDoc(),i=c(j,m),k=c(n,m);return c.Deferred(function(){var o=this;if(i.is("img")){i[0].onload=function(){AJS.log("replaceNode: new node's src has been loaded by the browser.");this.onload=null;o.resolve(this)};if(c.browser.opera){i[0].src=i.attr("src")}setTimeout(function(){o.resolve(i[0])},3000);m.createDocumentFragment().appendChild(i[0])}else{o.resolve(i[0])}}).done(function(o){k.replaceWith(o)}).promise()};var d=function(i,k){var h,j={contentId:Confluence.Editor.getContentId(),macro:{name:"gliffy",params:"",defaultParameterValue:"",body:""}};if(c.browser.msie&&AJS.$.Deferred){tinymce.confluence.NodeUtils.replaceNode=f}AJS.Rte.BookmarkManager.restoreBookmark();h=tinymce.confluence.MacroUtils.insertMacro(c.extend(true,j,i),k);if(h&&h.then){h.then(function(){if(c.browser.msie){tinymce.confluence.NodeUtils.replaceNode=g}},function(){if(c.browser.msie){tinymce.confluence.NodeUtils.replaceNode=g}})}AJS.log("insert gliffy macro");e();return h};return{getMacroParams:GLIFFY._confluence.utils.getMacroParams,insertMacro:d,fixEditorFocus:e,updateMacros:function(h){var i=c(AJS.Rte.getEditor().dom.select(".editor-inline-macro")).filter(function(j){return c(this).data("macro-name")===h});i.each(function(k,m){var n=c(this);var l=GLIFFY._confluence.utils.getMacroParams(n);var j=c.toJSON({contentId:Confluence.Editor.getContentId(),macro:{name:n.data("macro-name"),params:l,body:"",defaultParameterValue:""}});c.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:Confluence.getContextPath()+"/rest/tinymce/1/macro/placeholder",data:j,dataType:"text",success:function(o){n.after(o);n.remove()}})})}}};GLIFFY.confluence=b()}(AJS.$))});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-rte-editor-html5.js' */
AJS.bind("gliffy.init.rte",function(a){(function(b){GLIFFY._confluence.editor={obj:null,parentOverflow:null,isHtml5:true,loadedCallback:null,show:function(){b("#gliffy-editor").css("top",b(document).scrollTop());this.obj.parent().css("overflow","hidden");if(GLIFFY._confluence.editor.hidden){if(b.browser.msie){GLIFFY._confluence.editor.obj.css("visibility","visible")}else{GLIFFY._confluence.editor.obj.show()}GLIFFY._confluence.editor.hidden=false}GLIFFY._confluence.editor.html5Editor.focus();b("#gliffy-close").show();b("#gliffy-load-buttons").hide()},hide:function(){if(!GLIFFY._confluence.editor.hidden){GLIFFY._confluence.editor.html5Editor.blur();if(b.browser.msie){GLIFFY._confluence.editor.obj.css("visibility","hidden")}else{GLIFFY._confluence.editor.obj.hide()}GLIFFY._confluence.editor.hidden=true}b("#gliffy-close").hide();b("#gliffy-load-buttons").show();this.obj.parent().css({overflow:this.parentOverflow})},hidden:false,html5Editor:null,loaded:function(c){GLIFFY._confluence.editor.html5Editor=c;this.parentOverflow=b("#gliffy-editor").parent().css("overflow");b(".gliffy-spinner").remove();if(this.loadedCallback){this.loadedCallback()}},hideSpinner:function(){b(".gliffy-spinner").remove()}}}(AJS.$))});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-rte-macro.js' */
AJS.bind("gliffy.init.rte",function(a){(function(h){var e,k,l,i,m,g,f=false;var d=require("GliffySpinner");var j;var c;function b(o,n){h(window).trigger(o+".gliffyAnalytics",n)}k=function(n){this.name=n};k.prototype.isTemplateCategory=function(){return false};k.prototype.getName=function(){return this.name};k.prototype.getPanelLink=function(){return gliffySoy.macro.dialog.panelLink({key:this.getName(),title:this.getPanelText()})};k.prototype.getTemplate=function(){return""};k.prototype.getPanelText=function(){return""};k.prototype.primaryAction=function(p,o,q){p.preventDefault();p.stopPropagation();var n=o.find(".gliffy-content .gliffy-template.gliffy-active");AJS.trigger("createpagetemplate",[n.data("category"),n.data("name")])};k.prototype.getPrimaryButtonText=function(){return""};k.prototype.setup=function(n){};k.prototype.teardown=function(n){};e=function(){};e.prototype=new k("create");e.prototype.getTemplate=function(){return gliffySoy.macro.dialog.createPanel()};e.prototype.primaryAction=function(s,r,u){s.preventDefault();s.stopPropagation();var q=r.find(".gliffy-content .gliffy-template.gliffy-active"),p=q.data("name"),o=q.data("panels"),n,t;n=p!=="blank";t=o?"blank_"+o:"blank";b("trackEvent",{category:"panelCreate",action:n?"recent":t});if(o){if(o==="basic"){o=["com.gliffy.libraries.flowchart.flowchart_v1.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.swimlanes.swimlanes_v1.default","com.gliffy.libraries.images"]}else{if(o==="flowchart"){o=["com.gliffy.libraries.flowchart.flowchart_v1.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.swimlanes.swimlanes_v1.default","com.gliffy.libraries.images"]}else{if(o==="software"){o=["com.gliffy.libraries.uml.uml_v2.class","com.gliffy.libraries.uml.uml_v2.sequence","com.gliffy.libraries.uml.uml_v2.activity","com.gliffy.libraries.uml.uml_v2.state_machine","com.gliffy.libraries.uml.uml_v2.deployment","com.gliffy.libraries.uml.uml_v2.component","com.gliffy.libraries.uml.uml_v2.use_case","com.gliffy.libraries.erd.erd_v1.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.images"]}else{if(o==="bpmn"){o=["com.gliffy.libraries.flowchart.flowchart_v1.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.bpmn.bpmn_v1.events","com.gliffy.libraries.bpmn.bpmn_v1.activities","com.gliffy.libraries.bpmn.bpmn_v1.data_artifacts","com.gliffy.libraries.bpmn.bpmn_v1.gateways","com.gliffy.libraries.bpmn.bpmn_v1.connectors","com.gliffy.libraries.swimlanes.swimlanes_v1.default","com.gliffy.libraries.images"]}else{if(o==="network"){o=["com.gliffy.libraries.network.network_v4.rack","com.gliffy.libraries.network.network_v4.business","com.gliffy.libraries.network.network_v4.home","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.images"]}else{if(o==="ui"){o=["com.gliffy.libraries.ui.ui_v3.containers_content","com.gliffy.libraries.ui.ui_v3.navigation","com.gliffy.libraries.ui.ui_v3.forms_controls","com.gliffy.libraries.ui.ui_v3.icon_symbols","com.gliffy.libraries.ui.ui_v2.forms_components","com.gliffy.libraries.ui.ui_v2.content","com.gliffy.libraries.ui.ui_v2.miscellaneous","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.images"]}else{if(o==="venn"){o=["com.gliffy.libraries.venn.outline.default","com.gliffy.libraries.venn.flat.default","com.gliffy.libraries.venn.radial.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.images"]}else{if(o==="org"){o=["com.gliffy.libraries.flowchart.flowchart_v1.default","com.gliffy.libraries.basic.basic_v1.default","com.gliffy.libraries.images"]}}}}}}}}}AJS.trigger("gliffy.confluence.launchTemplate",[q.data("category"),p,o])};e.prototype.getPanelText=function(){return "Create a New Diagram"};e.prototype.getPrimaryButtonText=function(n){return "Create"};e.prototype.setup=function(o){var p={matchAll:true,sort:"modified",order:"descending",index:0,results:50,filterByUser:true},n=false;h.ajax({url:GLIFFY._confluence.gvars.gliffyApiEndpoint+"/diagrams.json",dataType:"json",data:p,cache:false,success:function(q){n=true;j.stop();o.find(".gliffy-content .gliffy-recent-results").append(gliffySoy.macro.dialog.searchResults({diagrams:q.diagrams,rootApi:GLIFFY._confluence.gvars.gliffyApiEndpoint}))},error:function(q){n=true;j.stop();o.find(".gliffy-content .gliffy-recent-results").append(gliffySoy.macro.dialog.searchResults({diagrams:[],rootApi:GLIFFY._confluence.gvars.gliffyApiEndpoint}))}});j=new d(o.find(".gliffy-content .gliffy-recent-results").get(0),{radius:25,color:"#666",inline:true});setTimeout(function(){if(!n){j.start()}},100)};e.prototype.teardown=function(n){};m=function(n,q,p){var o=this;this.insertOnly=n||false;this.message=q||null;this.blueprint=p||false;this.spaces=[{longName:"All Spaces",shortName:""}];this.sort=[{longName:"Last Modified",shortName:"modified"},{longName:"Title",shortName:"title"},{longName:"Created",shortName:"created"}];this.name="insert";this.view="grid";this.query="";h.ajax({type:"GET",url:AJS.format("{0}/rest/gliffy/1.0/spaces/legacy.json",Confluence.getContextPath()),dataType:"json",cache:false,success:function(s){for(var r=0;r<s.categoryList.length;r++){o.spaces.push(s.categoryList[r])}},error:function(t,r,s){AJS.log("space service unavailable "+r)}})};m.prototype=new k();m.prototype.constructor=m;m.prototype.getTemplate=function(){return gliffySoy.macro.dialog.insertPanel({query:this.query,insertOnly:this.insertOnly,message:this.message})};m.prototype.getPanelText=function(){return "Search for a Diagram"};m.prototype.getPrimaryButtonText=function(){if(this.insertOnly){return "Insert Diagram"}else{return "Use as a Template"}};m.prototype.scroll=function(q,p){var n=this,o=(new Date()).getTime();if(!n.__tempTime){n.__scrolling=true;n.__tempTime=o}else{if(o-n.__tempTime>200&&!n.__scrolling){n.__scrolling=true;n.__tempTime=o}}clearTimeout(n.__scrollTimeout);n.__scrollTimeout=setTimeout(function(){if(n.__scrolling){n.__scrolling=false;n.scrollEnd(q,p)}},200)};m.prototype.scrollEnd=function(p,n){var q=h("#gliffy-macro-dialog .gliffy-placeholder"),o;if(q.length>0&&this.isScrolledIntoView(q)){o=q.data();q.remove();this.search(n,o.index,o.results)}};m.prototype.isScrolledIntoView=function(q){var o=h("#gliffy-macro-dialog .gliffy-content"),s=0,r=s+o.height(),n=h(q).offset().top-o.offset().top,p=n+h(q).height();return(p>=s&&p<=r)||(n>=s&&n<=r)};m.prototype.search=function(o,t,q){var w=o.find(".gliffy-space-dropdown").data("value"),r=o.find(".gliffy-sort-dropdown").data("value"),s=o.find(".gliffy-sort-dropdown").data("order")||false,p,n={title:"ascending",created:"descending",modified:"descending"},x={title:"descending",created:"ascending",modified:"ascending"},y=this,v=y.query,u;if(!q||!t){q=20;t=0}p={query:encodeURIComponent(v),index:t,results:q,spaceKey:w,sort:r,order:(s)?x[r]:n[r]};h.ajax({url:GLIFFY._confluence.gvars.gliffyApiEndpoint+"/diagrams.json",dataType:"json",data:p,cache:false,success:function(A){u=o.find(".gliffy-content .gliffy-search-results");if(t===0){u.empty()}if(y.view==="grid"){u.append(gliffySoy.macro.dialog.searchResults({diagrams:A.diagrams,rootApi:GLIFFY._confluence.gvars.gliffyApiEndpoint,index:t,results:q}))}else{u.append(gliffySoy.macro.dialog.listSearchResults({diagrams:A.diagrams,rootApi:GLIFFY._confluence.gvars.gliffyApiEndpoint,index:t,results:q}))}for(var z=0;z<A.diagrams.length;z++){h(".gliffy-template[data-name='"+A.diagrams[z].attachmentId+"']").data("diagram",A.diagrams[z])}}})};m.prototype.setup=function(p){var n=this,o;p.find(".button-container-right").append(gliffySoy.macro.dialog.insertPanelCheckbox({insertOnly:n.insertOnly,blueprint:n.blueprint}));p.find(".gliffy-toggle-checkbox").change(function(s){var r=h(this).is(":checked"),q=p.find(".gliffy-button.gliffy-primary");if(r){q.text("Insert Diagram")}else{q.text(n.getPrimaryButtonText())}b("trackEvent",{category:"panelSearchToggleInsert",action:r})});o=p.find(".gliffy-question-link").click(function(){return false});if(o.tooltip){o.tooltip({live:false,gravity:"s",title:"data-tooltip",delayIn:500,delayOut:0,offset:5})}else{o.attr("title",o.data("tooltip"))}p.delegate("table.gliffy-list-search-results tr","click.gliffy-row-highlight",function(r){var s=h(this),q=s.find(".gliffy-template");if(q.length>0){p.find("table .gliffy-active").removeClass("gliffy-active");s.addClass("gliffy-active");q.addClass("gliffy-active")}});p.delegate("table.gliffy-list-search-results tr","dblclick.gliffy-row-highlight",function(r){var s=h(this),q=s.find(".gliffy-template");if(q.length>0){n.primaryAction(r,p)}});p.find(".gliffy-insert-search-form").append(gliffySoy.macro.dialog.insertDropdown({items:this.spaces,label:"",name:"gliffy-space-dropdown"}));p.find(".gliffy-insert-search-form").append(gliffySoy.macro.dialog.insertDropdown({items:this.sort,label:"Sort by:",name:"gliffy-sort-dropdown"}));p.find(".gliffy-insert-search-form").append(gliffySoy.macro.dialog.listGridToggle({view:n.view==="grid"?"gliffy-icon-grid":"gliffy-icon-list"}));p.find(".gliffy-list-grid-toggle").click(function(){var q=h(this);if(n.view==="grid"){q.removeClass("gliffy-icon-grid").addClass("gliffy-icon-list");n.view="list"}else{q.removeClass("gliffy-icon-list").addClass("gliffy-icon-grid");n.view="grid"}b("trackEvent",{category:"panelSearchToggleGridList",action:n.view});n.search(p)});p.find(".gliffy-btn.gliffy-dropdown,.gliffy-btn.gliffy-dropdown-toggle").click(function(q){q.preventDefault();q.stopPropagation();h(this).closest(".gliffy-btn-group").find("ul.gliffy-dropdown-menu").toggle()});p.bind("click.gliffy-btn-dropdown",function(){p.find(".gliffy-btn.gliffy-dropdown,.gliffy-btn.gliffy-dropdown-toggle");p.find("ul.gliffy-dropdown-menu:visible").hide()});p.find("ul.gliffy-dropdown-menu li").click(function(t){t.preventDefault();t.stopPropagation();var u=h(this),s=u.find("a").text(),q=u.find("a").data("value"),r=u.closest(".gliffy-btn-group");r.find("button.gliffy-dropdown").text(s);if(r.data("value")===q){r.data("order",!(r.data("order")==true))}else{r.data("value",q);r.data("order",false)}r.find("ul.gliffy-dropdown-menu").toggle();n.search(p)});p.find(".gliffy-insert-search").keyup(function(q){clearTimeout(n.timeout);n.query=h.trim(p.find(".gliffy-insert-search").val());n.timeout=setTimeout(function(){n.search(p)},500)}).keydown(function(q){if(q.which===13){q.preventDefault();n.query=h.trim(p.find(".gliffy-insert-search").val());n.search(p)}});p.find(".gliffy-insert-search-form").submit(function(q){q.stopPropagation();q.preventDefault()});p.find(".gliffy-content").scroll(function(q){n.scroll(q,p)});n.search(p)};m.prototype.teardown=function(n){n.find(".gliffy-toggle-insert").remove();n.unbind("click.gliffy-row-highlight");n.unbind("dblclick.gliffy-row-highlight");n.unbind("click.gliffy-btn-dropdown");n.find(".gliffy-content").unbind("scroll")};m.prototype.primaryAction=function(n,p,t){var v=p.find(".gliffy-content .gliffy-template.gliffy-active"),s=p.find(".gliffy-toggle-checkbox"),u,q,r=t.isFromBlueprint();n.preventDefault();n.stopPropagation();if(v.length>0){if(this.insertOnly||s.is(":checked")||r){q=v.data("diagram");if(q){u={};u.name=q.name;if(r){u.attachmentId=q.attachmentId}if(Confluence.Editor.getContentId()!=q.pageId){u.pageid=q.pageId}AJS.Rte.BookmarkManager.storeBookmark();var o={contentId:Confluence.Editor.getContentId(),macro:{name:"gliffy",params:u,defaultParameterValue:"",body:""}};GLIFFY.confluence.insertMacro(o);GLIFFY._confluence.macroDialog.hide();b("trackEvent",{category:"panelSearch",action:"insert"})}}else{b("trackEvent",{category:"panelSearch",action:"create"});AJS.trigger("gliffy.confluence.launchTemplate",[v.data("category"),v.data("name")])}}};i=function(){var n=this;this.name="import";this.transformers=[];h.ajax({url:GLIFFY._confluence.gvars.gliffyApiEndpoint+"/transform/config.json",type:"GET",cache:false,dataType:"json",success:function(p){AJS.log("gliffy-transform service available");for(var o=0;o<p.transformers.length;o++){AJS.log("supports "+p.transformers[o].name);n.transformers.push(p.transformers[o])}},error:function(){AJS.log("gliffy-transform service unavailable.");n.transformers=[{name:"Gliffy XML",ext:"gxml"}]}})};i.prototype=new k();i.prototype.constructor=i;i.prototype.getTemplate=function(){return gliffySoy.macro.dialog.importPanel({contextPath:AJS.Confluence.getContextPath()})};i.prototype.primaryAction=function(o,n,p){};i.prototype.getPanelText=function(){return "Import a Diagram"};i.prototype.isExtensionSupported=function(n){return h.grep(this.transformers,function(o){if(o.ext==="gliffy,gon"){return"gon"===n||"gliffy"===n}else{return o.ext===n}}).length>0};i.prototype.setupFormSubmit=function(s){var o=h("#gliffy-create-import-error"),p=h("#gliffy-import-wait"),r=h("#gliffy-import-file"),t=h("#gliffy-create-import-form"),n=this,u,q;s.find("#gliffy-create-import-form").ajaxForm({type:"POST",timeout:180000,beforeSubmit:function(){try{q=AJS.Meta.get("atl-token");if(q){h("#gliffy-security-token").val(q)}}catch(v){}u=r.val().split(".").pop();if(!n.submitting&&n.isExtensionSupported(u)){b("trackEvent",{category:"import",action:u});o.empty();c=new d(p.get(0),{radius:10,color:"#666",inline:true});c.start();n.submitting=true;return true}else{AJS.messages.error("#gliffy-create-import-error",{title:"The file type is not supported for importing:"+" "+u});return false}},success:function(y){n.submitting=false;c.stop();t.each(function(){this.reset()});var x=h.parseJSON(y);var v=x.gon;try{AJS.trigger("gliffy.confluence.launchEditorWithGonData",v);GLIFFY._confluence.macroDialog.hide()}catch(w){o.empty();AJS.messages.error("#gliffy-create-import-error",{title:"Sorry, we could not import your file."})}},error:function(v){console.error(v);n.submitting=false;c.stop();t.each(function(){this.reset()});AJS.messages.error("#gliffy-create-import-error",{title:"Sorry, we could not import your file."})}})};i.prototype.setup=function(o){var n=this;o.find(".gliffy-button.gliffy-primary").hide();o.find("#gliffy-file-type-gxml").click(function(){o.find(".gliffy-import-help-container").empty().append(gliffySoy.macro.dialog.importGliffyHelpPanel({contextPath:AJS.Confluence.getContextPath()}));return false});o.find("#gliffy-file-type-gon").click(function(){o.find(".gliffy-import-help-container").empty().append(gliffySoy.macro.dialog.importGliffyGonHelpPanel({contextPath:AJS.Confluence.getContextPath()}));return false});o.find("#gliffy-file-type-vdx").click(function(){o.find(".gliffy-import-help-container").empty().append(gliffySoy.macro.dialog.importVisioHelpPanel());return false});o.find("#gliffy-import-file").bind("change.gliffyImportPanel",function(){h(this).closest("form").submit()});n.setupFormSubmit(o)};i.prototype.teardown=function(n){n.find(".gliffy-button.gliffy-primary").show()};l=function(n){this.category=n;this.name=n.uid||n.id};l.prototype=new k();l.prototype.constructor=l;l.prototype.primaryAction=function(r,p,s){r.preventDefault();r.stopPropagation();var o=p.find(".gliffy-content .gliffy-template.gliffy-active"),n=o.data("name"),q=o.data("category");b("trackEvent",{category:"panel."+q,action:n});AJS.trigger("gliffy.confluence.launchTemplate",[q,n])};l.prototype.isTemplateCategory=function(){return true};l.prototype.getTemplate=function(){return gliffySoy.macro.dialog.templatePanel({category:this.category.uid,templates:this.category.templates,contextPath:AJS.Confluence.getContextPath()})};l.prototype.getPanelText=function(){return this.category.desc};l.prototype.getPrimaryButtonText=function(n){return "Create"};g=function(n){this.category=n;this.name=n.uid||n.id};g.prototype=new k();g.prototype.constructor=l;g.prototype.isTemplateCategory=function(){return true};g.prototype.getTemplate=function(){return gliffySoy.macro.dialog.templatePanel({category:this.category.uid,templates:this.category.templates,contextPath:AJS.Confluence.getContextPath()})};g.prototype.getPanelText=function(){return this.category.desc.charAt(0).toUpperCase()+this.category.desc.slice(1)};g.prototype.getPrimaryButtonText=function(n){return "Create"};g.prototype.setup=function(n){};g.prototype.teardown=function(n){};g.prototype.primaryAction=function(p,o,q){p.preventDefault();p.stopPropagation();var n=o.find(".gliffy-content .gliffy-template.gliffy-active");b("trackEvent",{category:"macro",action:"addToConfluenceTemplate"});AJS.trigger("gliffy.confluence.addGliffyDiagramToPage",[n.data("category"),n.data("name")])};GLIFFY._confluence.macroDialog={initialized:false,panels:{},primaryActions:{},primaryButtonText:{},canCreateAttachmentPromise:null,panelState:null,setPanelState:function(n){this.panelState=n},getPanelState:function(){return this.panelState},setActivePanelLink:function(n){this.baseDialog.find("li.gliffy-active").removeClass("gliffy-active");n.addClass("gliffy-active")},setActiveTemplate:function(n){this.baseDialog.find(".gliffy-content .gliffy-template.gliffy-active").removeClass("gliffy-active");n.addClass("gliffy-active")},registerPrimaryAction:function(n){this.primaryActions[n.getName()]=n;if(n.getPrimaryButtonText()){this.primaryButtonText[n.getName()]=n.getPrimaryButtonText()}},updatePrimaryButtonText:function(n){this.baseDialog.find(".gliffy-button.gliffy-primary").text(this.primaryButtonText[n])},bindPrimaryButtonClick:function(){var n=this;this.baseDialog.delegate(".gliffy-button.gliffy-primary","click",function(o){if(n.getPanelState()){n.primaryActions[n.getPanelState()].primaryAction(o,n.baseDialog,n)}})},bindSecondaryButtonClick:function(){var n=this;this.baseDialog.delegate(".gliffy-button.gliffy-secondary","click",function(o){o.preventDefault();n.hide()})},bindBlanketClick:function(){var n=this;this.blanket.click(function(){n.hide()})},bindPanelLinkClick:function(){var n=this;h(this.baseDialog).delegate("ul.gliffy-panel-links li","click",function(q){q.preventDefault();q.stopPropagation();var p=h(this),o=p.data("key");if(o){n.renderPanel(n.panels[o])}})},bindTemplateElementClick:function(){var n=this;h(this.baseDialog).delegate(".gliffy-content .gliffy-template","click",function(o){o.preventDefault();n.setActiveTemplate(h(this))});h(this.baseDialog).delegate(".gliffy-content .gliffy-template","dblclick",function(o){o.preventDefault();if(n.getPanelState()){n.primaryActions[n.getPanelState()].primaryAction(o,n.baseDialog,n)}})},registerPanel:function(n){this.panels[n.getName()]=n;n.insertedPanelLink=h(n.getPanelLink());if(n.isTemplateCategory()){this.baseDialog.find(".gliffy-sidebar-templates ul").append(n.insertedPanelLink)}else{this.baseDialog.find(".gliffy-sidebar-panels ul.gliffy-panel-links").append(n.insertedPanelLink)}this.registerPrimaryAction(n)},renderPanel:function(n){if(this.getPanelState()){this.panels[this.getPanelState()].teardown(this.baseDialog)}this.baseDialog.find(".gliffy-content").empty().append(n.getTemplate());this.setActivePanelLink(n.insertedPanelLink);this.updatePrimaryButtonText(n.getName());this.setPanelState(n.getName());n.setup(this.baseDialog)},populateTemplateCategories:function(n){var o=this;h.ajax({url:GLIFFY._confluence.gvars.gliffyApiEndpoint+"/templateLibraries/com.gliffy.template_library.default",type:"GET",cache:false,success:function(r,u,t){if(n===g){var s={desc:"Blank",template:[{desc:"Blank",uid:"com.gliffy.template.blank",previewLocation:"",templateLocation:""}],uid:"com.gliffy.templates.blank"};r.categories.unshift(s)}for(var p=0;p<r.categories.length;p++){var q=r.categories[p];o.registerPanel(new n(q))}},error:function(p){o.baseDialog.find(".gliffy-sidebar-templates").remove()}})},init:function(){this.canCreateAttachmentPromise=this.canCreateAttachments()},canCreateAttachments:function(){var o=new PromiseJS.Deferred(),n=Confluence.Editor.getContentId(),p;if(n==="0"){o.reject("Please save the page before creating a diagram.")}else{h.ajax({type:"GET",url:AJS.format("{0}/ceo/{1}/permission",GLIFFY._confluence.gvars.gliffyApiEndpoint,n),dataType:"json",cache:false,success:function(){o.resolve()},error:function(q){if(q.status===402){p="License Error. Please contact your Administrator."}else{if(q.status===404){p="No create permission or you are not logged in."}else{p="Error. Please contact your Administrator."}}o.reject(p)}})}return o.promise},isFromBlueprint:function(){return AJS.Meta.get("form-name")==="createpagetemplate"||AJS.Meta.get("form-name")==="editpagetemplate"},setupButtons:function(){this.bindPrimaryButtonClick();this.bindSecondaryButtonClick();this.bindBlanketClick();this.bindPanelLinkClick();this.bindTemplateElementClick()},buildDialog:function(){var q,o=this,p,n,r;r=GLIFFY._confluence.utils.initAnalytics();this.blanket=h(gliffySoy.macro.dialog.blanket());if(this.isFromBlueprint()){r.then(function(){b("trackEvent",{category:"macroInit",action:"blueprint"})});o.baseDialog=h(gliffySoy.macro.dialog.base({insertOnly:false}));o.populateTemplateCategories(g);n=new m(true,"",true);o.registerPanel(n);o.setupButtons();o.renderPanel(n);o.blanket.appendTo("body");o.baseDialog.appendTo("body");o.initialized=true}else{this.canCreateAttachmentPromise.then(function(){r.then(function(){b("trackEvent",{category:"macroInit",action:"normal"})});o.baseDialog=h(gliffySoy.macro.dialog.base({insertOnly:false}));o.populateTemplateCategories(l);p=[new e(),new i(),new m()];for(q=0;q<p.length;q++){o.registerPanel(p[q])}o.setupButtons();o.renderPanel(p[0]);o.blanket.appendTo("body");o.baseDialog.appendTo("body");o.initialized=true},function(s){r.then(function(){b("trackEvent",{category:"macroInit",action:"noAttachPermissions"})});o.baseDialog=h(gliffySoy.macro.dialog.base({insertOnly:true}));n=new m(true,s);o.registerPanel(n);o.setupButtons();o.renderPanel(n);o.blanket.appendTo("body");o.baseDialog.appendTo("body");o.initialized=true})}},show:function(){if(!this.initialized){this.buildDialog()}else{var o=(h("body").height()-h("#gliffy-macro-dialog").height())/2;var n=20;if(o<n){if(window.navigator.userAgent.indexOf("Trident")!=-1){h("body").css("overflow-y","scroll")}h("#gliffy-macro-dialog").css("top",n);h("#gliffy-macro-dialog").css("margin-top",0)}this.blanket.show();this.baseDialog.show()}},hide:function(){if(this.initialized){var n=(h("body").height()-h("#gliffy-macro-dialog").height())/2;if(window.navigator.userAgent.indexOf("Trident")!=-1){h("body").css("overflow-y","hidden");window.scrollTo(0,0)}this.blanket.hide();this.baseDialog.hide()}}};GLIFFY._confluence.macroDialog.init()}(AJS.$))});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-rte.js' */
AJS.bind("gliffy.init.rte",function(a){(function(e){AJS.log("AJS.version="+AJS.version);var b=function(k){k.show();k.gotoPanel(0,0)};var j=function(l,k){if(GLIFFY._confluence.gvars.spaces.length<1){e.ajax({type:"GET",url:AJS.format("{0}/rest/gliffy/1.0/spaces/legacy.json",Confluence.getContextPath()),dataType:"json",cache:false,success:function(m){GLIFFY._confluence.gvars.spaces=m.categoryList;e(".gliffy-space-dropdown").append(gliffySoy.macro.dialog.spaceOptions({spaces:m.categoryList}));b(l);if(k){k()}},error:function(o,m,n){AJS.log("space service unavailable "+m);b(l)}})}else{b(l)}};AJS.bind("gliffy.confluence.showMacroDialog",function(k,l){AJS.Rte.getEditor().selection.setContent("");AJS.Rte.BookmarkManager.storeBookmark();GLIFFY._confluence.macroDialog.show();return false});e("#gliffy").click(function(){AJS.trigger("gliffy.confluence.showMacroDialog")});var c=GLIFFY._confluence.utils.getUrlVars();if(c.showGliffyMacro){var g=AJS.Rte.getEditor();var f=g.dom.create("p");var d=e(g.getBody());var i=d.find("p:first");if(i.length>0){i.before(f)}else{d.prepend(f)}g.dom.add(f,"p",{"class":"gliffy-caret"});g.focus();g.selection.select(g.dom.select("p.gliffy-caret")[0]);var h=g.selection.getBookmark();g.selection.moveToBookmark(h);g.dom.remove(g.dom.select("p.gliffy-caret")[0]);AJS.trigger("gliffy.confluence.showMacroDialog",{createDiagramType:c.createDiagramType})}}(AJS.$))});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = '/templates/gliffy-rte.soy' */
// This file was automatically generated from gliffy-rte.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace gliffySoy.macro.dialog.
 */

if (typeof gliffySoy == 'undefined') { var gliffySoy = {}; }
if (typeof gliffySoy.macro == 'undefined') { gliffySoy.macro = {}; }
if (typeof gliffySoy.macro.dialog == 'undefined') { gliffySoy.macro.dialog = {}; }


gliffySoy.macro.dialog.blanket = function(opt_data, opt_ignored) {
  return '<div id="gliffy-macro-blanket"></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.blanket.soyTemplateName = 'gliffySoy.macro.dialog.blanket';
}


gliffySoy.macro.dialog.base = function(opt_data, opt_ignored) {
  return '<div id="gliffy-macro-dialog"><div class="gliffy-header"><div class="gliffy-logo"></div></div><div class="gliffy-dialog-body"><div class="gliffy-sidepanel"><div class="gliffy-sidebar-panels"><ul class="gliffy-panel-links"></ul></div>' + ((opt_data.insertOnly != true) ? '<div class="gliffy-sidebar-templates"><ul class="gliffy-panel-links"><li class="gliffy-panel-title"><b>' + soy.$$escapeHtml("Start with a Gliffy Template") + '</b></li></ul></div>' : '') + '</div><div class="gliffy-content"></div><div class="gliffy-clear"></div><div class="gliffy-footer"><div class="button-container-left"></div><div class="button-container-right"><ul class="gliffy-button-list"><li><a class="gliffy-button gliffy-primary" href="#">' + soy.$$escapeHtml("Create") + '</a></li><li><a class="gliffy-button gliffy-secondary" href="#">' + soy.$$escapeHtml("Cancel") + '</a></li></ul></div><div class="gliffy-clear"></div></div></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.base.soyTemplateName = 'gliffySoy.macro.dialog.base';
}


gliffySoy.macro.dialog.panelLink = function(opt_data, opt_ignored) {
  return '<li ' + ((opt_data.active == true) ? 'class="gliffy-active"' : '') + '  data-key="' + soy.$$escapeHtml(opt_data.key) + '"><a href="#">' + soy.$$escapeHtml(opt_data.title) + '</a></li>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.panelLink.soyTemplateName = 'gliffySoy.macro.dialog.panelLink';
}


gliffySoy.macro.dialog.templatePanel = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.category == 'com.gliffy.templates.blank') {
    output += '<div class="gliffy-template gliffy-active" data-category="com.gliffy.templates.blank" data-name="com.gliffy.template.blank"><div class="gliffy-image-placeholder"/><span>' + soy.$$escapeHtml("Blank") + '</span></div>';
  } else {
    var templateList33 = opt_data.templates;
    var templateListLen33 = templateList33.length;
    for (var templateIndex33 = 0; templateIndex33 < templateListLen33; templateIndex33++) {
      var templateData33 = templateList33[templateIndex33];
      output += '<div data-category="' + soy.$$escapeHtml(opt_data.category) + '" data-name="' + soy.$$escapeHtml(templateData33.uid) + '" class="gliffy-template ' + ((templateIndex33 == 0) ? 'gliffy-active' : '') + '"><div class="gliffy-image-placeholder" style="background-image:url(\'' + soy.$$escapeHtml(opt_data.contextPath) + '/rest/gliffy/1.0' + soy.$$escapeHtml(templateData33.thumbnailLocation) + '\')" /><span>' + soy.$$escapeHtml(templateData33.desc) + '</span></div>';
    }
  }
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.templatePanel.soyTemplateName = 'gliffySoy.macro.dialog.templatePanel';
}


gliffySoy.macro.dialog.createPanel = function(opt_data, opt_ignored) {
  return '<div class="gliffy-blank-container"><div class="gliffy-template gliffy-active" data-category="com.gliffy.templates.blank" data-panels="basic" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-basic"/><span>' + soy.$$escapeHtml("Basic") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="bpmn" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-bpmn"/><span>' + soy.$$escapeHtml("Flowchart \x26 BPMN") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="software" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-uml"/><span>' + soy.$$escapeHtml("Software Design: UML \x26 ERD") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="network" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-network"/><span>' + soy.$$escapeHtml("Network") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="ui" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-wireframe"/><span>' + soy.$$escapeHtml("Wireframe") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="org" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-org"/><span>' + soy.$$escapeHtml("Org Chart") + '</span></div><div class="gliffy-template" data-category="com.gliffy.templates.blank" data-panels="venn" data-name="com.gliffy.template.blank" ><div class="gliffy-image-placeholder gliffy-symbol-venn"/><span>' + soy.$$escapeHtml("Venn Diagram") + '</span></div><div class="gliffy-template" data-category="com.gliffy.template.mindmap_blank" data-panels="mindmap" data-name="com.gliffy.template.mindmap_blank" ><div class="gliffy-image-placeholder gliffy-symbol-mindmap"/><span>' + soy.$$escapeHtml("Mind Map") + '</span></div><div class="gliffy-clear"></div></div><div class="gliffy-recent-container"><div class="gliffy-recent-title">' + soy.$$escapeHtml("Use a Recent Diagram as a Template") + '</div><div class="gliffy-recent-results"><div class="gliffy-spinner-container"></div></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.createPanel.soyTemplateName = 'gliffySoy.macro.dialog.createPanel';
}


gliffySoy.macro.dialog.searchResults = function(opt_data, opt_ignored) {
  var output = '';
  if (opt_data.diagrams.length > 0) {
    var diagramList73 = opt_data.diagrams;
    var diagramListLen73 = diagramList73.length;
    for (var diagramIndex73 = 0; diagramIndex73 < diagramListLen73; diagramIndex73++) {
      var diagramData73 = diagramList73[diagramIndex73];
      output += '<div data-category="com.gliffy.transform.diagram" data-name="' + soy.$$escapeHtml(diagramData73.attachmentId) + '" class="gliffy-template"><div class="gliffy-image-placeholder" style="background-image:url(\'' + soy.$$escapeHtml(opt_data.rootApi) + soy.$$escapeHtml(diagramData73.urls.thumbnail) + '\')" /><span>' + soy.$$escapeHtml(diagramData73.name) + '</span></div>';
    }
    output += (opt_data.results == opt_data.diagrams.length) ? '<div class="gliffy-placeholder" data-index="' + soy.$$escapeHtml(opt_data.index + opt_data.results) + '" data-results="' + soy.$$escapeHtml(opt_data.results) + '"></div>' : '';
  } else {
    output += '<div style="text-indent:7.5px;">' + soy.$$escapeHtml("No Diagrams Found") + '</div>';
  }
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.searchResults.soyTemplateName = 'gliffySoy.macro.dialog.searchResults';
}


gliffySoy.macro.dialog.listGridToggle = function(opt_data, opt_ignored) {
  return '<span class="gliffy-list-grid-toggle ' + soy.$$escapeHtml(opt_data.view) + '"></span>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.listGridToggle.soyTemplateName = 'gliffySoy.macro.dialog.listGridToggle';
}


gliffySoy.macro.dialog.listSearchResults = function(opt_data, opt_ignored) {
  var output = '<table class="gliffy-list-search-results">' + ((opt_data.index == 0) ? '<thead><tr><th class="gliffy-table-column-diagram"><div class="gliffy-background-f0"></div></th><th class="gliffy-table-column-space">' + soy.$$escapeHtml("Space") + '</th><th class="gliffy-table-column-date">' + soy.$$escapeHtml("Last Modified") + '</th></tr></thead>' : '') + '<tbody>';
  if (opt_data.diagrams.length > 0) {
    var diagramList110 = opt_data.diagrams;
    var diagramListLen110 = diagramList110.length;
    for (var diagramIndex110 = 0; diagramIndex110 < diagramListLen110; diagramIndex110++) {
      var diagramData110 = diagramList110[diagramIndex110];
      output += '<tr><td><div data-category="com.gliffy.transform.diagram" data-name="' + soy.$$escapeHtml(diagramData110.attachmentId) + '" class="gliffy-template"><div class="gliffy-image-placeholder" style="background-image:url(\'' + soy.$$escapeHtml(opt_data.rootApi) + soy.$$escapeHtml(diagramData110.urls.thumbnail) + '\')" /></div><div class="gliffy-diagram-list-info">' + soy.$$escapeHtml(diagramData110.name) + '<div class="gliffy-list-label">' + soy.$$escapeHtml("Last Modified by") + ' ' + soy.$$escapeHtml(diagramData110.lastModifier) + '</div></div></td><td>' + soy.$$escapeHtml(diagramData110.spaceName) + '</td><td>' + soy.$$escapeHtml(diagramData110.lastModifiedFriendly) + '</td></tr>';
    }
  } else {
    output += '<tr><td><div style="text-indent:7.5px;">' + soy.$$escapeHtml("No Diagrams Found") + '</div></td><td></td><td></td></tr>';
  }
  output += '</tbody></table>' + ((opt_data.results == opt_data.diagrams.length) ? '<div class="gliffy-placeholder" data-index="' + soy.$$escapeHtml(opt_data.index + opt_data.results) + '" data-results="' + soy.$$escapeHtml(opt_data.results) + '"></div>' : '');
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.listSearchResults.soyTemplateName = 'gliffySoy.macro.dialog.listSearchResults';
}


gliffySoy.macro.dialog.insertPanel = function(opt_data, opt_ignored) {
  return '<div><form class="gliffy-insert-search-form"><input class="gliffy-insert-search" type="text" placeholder="' + soy.$$escapeHtml("Search for a diagram") + '" value="' + soy.$$escapeHtml(opt_data.query) + '"></form>' + ((opt_data.message != null) ? '<div class="gliffy-warning-message"><div class="aui-message closeable shadowed warning"><p class="title"><span class="aui-icon icon-generic"></span><strong>' + soy.$$escapeHtml("Sorry, you cannot create new diagrams but you may insert existing ones.") + '</strong></p><p>' + soy.$$escapeHtml(opt_data.message) + '</p></div></div>' : '') + '<div class="gliffy-search-results ' + ((opt_data.insertOnly == true) ? 'gliffy-no-border' : '') + '"></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.insertPanel.soyTemplateName = 'gliffySoy.macro.dialog.insertPanel';
}


gliffySoy.macro.dialog.insertPanelCheckbox = function(opt_data, opt_ignored) {
  return '<form class="gliffy-toggle-insert">' + ((opt_data.blueprint != true) ? '<input class="gliffy-toggle-checkbox" type="checkbox" ' + ((opt_data.insertOnly == true) ? 'checked disabled' : '') + '/><span>' + soy.$$escapeHtml("Link to Original Diagram") + '</span><a class="gliffy-question-link" href="#" data-tooltip="' + soy.$$escapeHtml("Select this option to link and display the original diagram. Modifications to the original will be reflected in linked locations.") + '"><span class="gliffy-question-icon"></span></a>' : '') + '</form>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.insertPanelCheckbox.soyTemplateName = 'gliffySoy.macro.dialog.insertPanelCheckbox';
}


gliffySoy.macro.dialog.insertDropdown = function(opt_data, opt_ignored) {
  var output = ((opt_data.label.length > 0) ? '<span class="gliffy-dropdown-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' : '') + '<div class="gliffy-btn-group ' + soy.$$escapeHtml(opt_data.name) + '" data-value="' + soy.$$escapeHtml(opt_data.items[0].shortName) + '"><button class="gliffy-btn gliffy-dropdown">' + soy.$$escapeHtml(opt_data.items[0].longName) + '</button><button class="gliffy-btn gliffy-dropdown-toggle"><span class="gliffy-caret"></span></button><ul class="gliffy-dropdown-menu">';
  var itemList185 = opt_data.items;
  var itemListLen185 = itemList185.length;
  for (var itemIndex185 = 0; itemIndex185 < itemListLen185; itemIndex185++) {
    var itemData185 = itemList185[itemIndex185];
    output += '<li><a href="#" data-value="' + soy.$$escapeHtml(itemData185.shortName) + '">' + soy.$$escapeHtml(itemData185.longName) + '</a></li>';
  }
  output += '</ul></div>';
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.insertDropdown.soyTemplateName = 'gliffySoy.macro.dialog.insertDropdown';
}


gliffySoy.macro.dialog.importPanel = function(opt_data, opt_ignored) {
  return '<div id="gliffy-upload-attachment"><form id="gliffy-create-import-form" class="aui" method="post" enctype="multipart/form-data" action="' + soy.$$escapeHtml(opt_data.contextPath) + '/rest/gliffy/1.0/diagrams/import"><fieldset class="inline"><div class="field gliffy-import-field-group"><input class="gliffy-import-text-input" type="text" placeholder="' + soy.$$escapeHtml("Upload a file from your computer") + '"/><a class="gliffy-import-browse">' + soy.$$escapeHtml("Browse") + '</a><div class="gliffy-file-input-wrapper"><input type="file" name="file" id="gliffy-import-file" class="gliffy-file-upload"/></div><input id="gliffy-security-token" type="hidden" name="atl_token" value="" /><span id="gliffy-import-wait"></span><div class="gliffy-clear"></div><div id="gliffy-create-import-error" class="error gliffy-import-description"></div><div class="gliffy-create-import-type-description">' + soy.$$escapeHtml("The following file types are supported [click each for more info]:") + '</div><div id="gliffy-create-import-types" class="gliffy-create-import-types"><ul><li><a id="gliffy-file-type-gon" href="#">' + soy.$$escapeHtml("Gliffy Diagram") + ' (.gliffy, .gon)</a></li><li><a id="gliffy-file-type-gxml" href="#">' + soy.$$escapeHtml("Gliffy Diagram") + ' (.gxml)</a></li><li><a id="gliffy-file-type-vdx" href="#">' + soy.$$escapeHtml("Visio Diagram") + ' (.vsdx, .vdx)</a></li></ul></div></div></fieldset></form><div class="#gliffy-create-import-error"></div><div class="gliffy-import-help-container"></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importPanel.soyTemplateName = 'gliffySoy.macro.dialog.importPanel';
}


gliffySoy.macro.dialog.importGliffyHelpPanel = function(opt_data, opt_ignored) {
  return '<div class="gliffy-help-image"><img src="' + soy.$$escapeHtml(opt_data.contextPath) + '/download/resources/com.gliffy.integration.confluence/icons/gliffy_online_file_menu.png"/><p><sup>*</sup> ' + soy.$$escapeHtml("Gliffy Online File Menu") + '</p></div><div class="gliffy-help-text"><p>' + soy.$$escapeHtml("The import dialog supports the import of Gliffy Diagrams (.gxml) that are exported from the Gliffy Editor.") + '</p><p>' + soy.$$escapeHtml("This allows you to import a diagram from any Gliffy product be it the Gliffy JIRA Plugin, Gliffy Online *, or even from another Confluence page.") + '</p><p>' + soy.$$escapeHtml("From the Gliffy Editor, navigate to the \x27file\x27 menu and choose \x27Export as Gliffy XML\x27.") + '</p><div class="aui-message warning shadowed"><p class="title"><span class="aui-icon icon-warning"></span><strong>' + soy.$$escapeHtml("Using Gliffy Diagrams Attached to a Confluence Page or JIRA Issue") + '</strong></p><p>' + soy.$$escapeHtml("Gliffy Diagrams downloaded as an attachment from a Confluence Page or JIRA Issue are not guaranteed to work, unless it was exported using the method described above.") + '</p><p>' + soy.$$escapeHtml("An easy way to tell if your diagram will import is to look for the \x3ccode\x3e.gxml\x3c/code\x3e extension in your filename.") + '</p></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importGliffyHelpPanel.soyTemplateName = 'gliffySoy.macro.dialog.importGliffyHelpPanel';
}


gliffySoy.macro.dialog.importGliffyGonHelpPanel = function(opt_data, opt_ignored) {
  return '<div class="gliffy-help-image"><img src="' + soy.$$escapeHtml(opt_data.contextPath) + '/download/resources/com.gliffy.integration.confluence/icons/gliffy_export_file_menu.png"/><p><sup>*</sup> ' + soy.$$escapeHtml("Gliffy HTML5 File Menu") + '</p></div><div class="gliffy-help-text"><p>' + soy.$$escapeHtml("The import dialog supports the import of Gliffy Diagrams (.gon) that are exported from the Gliffy HTML5 Editor.") + '</p><p>' + soy.$$escapeHtml("From the Gliffy HTML5 Editor, navigate to the \x27File\x27 menu and choose \x27Export as Gliffy\x27.") + '</p><div class="aui-message info" style="width: 440px;"><p class="title"><span class="aui-icon icon-info"></span><strong>' + soy.$$escapeHtml("Gliffy HTML5 files are fully portable!") + '</strong></p><p>' + soy.$$escapeHtml("You can download a Gliffy HTML5 diagram directly from the attachments page. Make sure your diagram is of this content type:") + '</p><p><code>' + soy.$$escapeHtml("application/gliffy+json") + '</code></p><p>' + soy.$$escapeHtml("Just attach the diagram to any Confluence page, and you can immediately use \x27Insert Diagram\x27 from the macro dialog to show it on your wiki page.  No importing is necessary!") + '</p></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importGliffyGonHelpPanel.soyTemplateName = 'gliffySoy.macro.dialog.importGliffyGonHelpPanel';
}


gliffySoy.macro.dialog.importVisioHelpPanel = function(opt_data, opt_ignored) {
  return '<div class="gliffy-help-text"><span id="gliffy-visio-description-spinner"></span><p id="gliffy-visio-description">' + soy.$$escapeHtml("The import dialog supports the import of Visio diagrams (.vsdx, .vdx) that are saved from Microsoft Visio.") + '</p><h3 id="gliffy-import-visio-prep">' + soy.$$escapeHtml("Preparing the Visio File") + '</h3><ol><li>' + soy.$$escapeHtml("In Visio, open the file that you want to import into Gliffy.") + '</li><li>' + soy.$$escapeHtml("If this file has multiple worksheets, select the worksheet that you want to export.") + '</li><li>' + soy.$$escapeHtml("Select File \x3e Save As.") + '</li><li>' + soy.$$escapeHtml("Choose either \x22Visio Drawing (*.vsdx)\x22 or \x22XML Drawing (*.vdx)\x22.") + '</li><li>' + soy.$$escapeHtml("Save the file.") + '</li></ol><h3 id="gliffy-import-visio-reduce-size">' + soy.$$escapeHtml("Reducing the Visio File Size (Optional)") + '</h3><ol><li>' + soy.$$escapeHtml("Load the file into Visio.") + '</li><li>' + soy.$$escapeHtml("Select File \x3e Info.") + '</li><li>' + soy.$$escapeHtml("Click on the button \x22Reduce File Size\x22 and check the boxes.") + '</li><li>' + soy.$$escapeHtml("Save the file.") + '</li></ol><div class="aui-message warning shadowed"><p class="title"><span class="aui-icon icon-warning"></span><strong>' + soy.$$escapeHtml("Missing Shapes") + '</strong></p><div class="gliffy-import-missing-shape"></div><p>' + soy.$$escapeHtml("If you see a shape like the image on the right then you have encountered a shape that the importer was not able to convert. The most common reason for this occurs when using 3rd party symbols or Visio clip art. Feel free to contact support if you experience these at") + ' <a href="mailto:support@gliffy.com">support@gliffy.com</a>.</p></div></div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importVisioHelpPanel.soyTemplateName = 'gliffySoy.macro.dialog.importVisioHelpPanel';
}


gliffySoy.macro.dialog.spaceOptions = function(opt_data, opt_ignored) {
  var output = '';
  var spaceList276 = opt_data.spaces;
  var spaceListLen276 = spaceList276.length;
  for (var spaceIndex276 = 0; spaceIndex276 < spaceListLen276; spaceIndex276++) {
    var spaceData276 = spaceList276[spaceIndex276];
    output += '<option value="' + soy.$$escapeHtml(spaceData276.shortName) + '">' + soy.$$escapeHtml(spaceData276.longName) + '</option>';
  }
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.spaceOptions.soyTemplateName = 'gliffySoy.macro.dialog.spaceOptions';
}


gliffySoy.macro.dialog.searchResult = function(opt_data, opt_ignored) {
  var output = '<table><thead><tr class="gliffy-data-table-header"><th class="gliffy-title-field">' + soy.$$escapeHtml("Title") + '</th><th class="gliffy-space-field">' + soy.$$escapeHtml("Space") + '</th><th class="gliffy-last-modified-field">' + soy.$$escapeHtml("Last Modified") + '</th></tr></thead><tbody>';
  var diagramList291 = opt_data.diagrams;
  var diagramListLen291 = diagramList291.length;
  if (diagramListLen291 > 0) {
    for (var diagramIndex291 = 0; diagramIndex291 < diagramListLen291; diagramIndex291++) {
      var diagramData291 = diagramList291[diagramIndex291];
      output += '<tr data-attachment-id="' + soy.$$escapeHtml(diagramData291.attachmentId) + '" data-name="' + soy.$$escapeHtml(diagramData291.name) + '" data-page-id="' + soy.$$escapeHtml(diagramData291.pageId) + '" data-version="' + soy.$$escapeHtml(diagramData291.version) + '" ' + ((diagramIndex291 == 0) ? 'class="gliffy-selected"' : '') + '><td class="gliffy-title-field">' + soy.$$escapeHtml(diagramData291.name) + '</td><td class="gliffy-space-field">' + soy.$$escapeHtml(diagramData291.spaceName) + '</td><td class="gliffy-last-modified-field">' + soy.$$escapeHtml(diagramData291.lastModifiedFriendly) + '</td></tr>';
    }
  } else {
    output += '<tr data-empty="true"><td>' + soy.$$escapeHtml("No results") + '</td></tr>';
  }
  output += '</tbody></table>';
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.searchResult.soyTemplateName = 'gliffySoy.macro.dialog.searchResult';
}


gliffySoy.macro.dialog.importResult = function(opt_data, opt_ignored) {
  var output = '<ul id="gliffy-import-list" class="gliffy-image-list">';
  var attachmentList319 = opt_data.attachments;
  var attachmentListLen319 = attachmentList319.length;
  if (attachmentListLen319 > 0) {
    for (var attachmentIndex319 = 0; attachmentIndex319 < attachmentListLen319; attachmentIndex319++) {
      var attachmentData319 = attachmentList319[attachmentIndex319];
      output += gliffySoy.macro.dialog.importResultItem({attachment: attachmentData319, contextPath: opt_data.contextPath});
    }
  } else {
    output += '<li id="gliffy-import-empty" data-empty="true"><span>' + soy.$$escapeHtml("No results") + '</span></li>';
  }
  output += '</ul>';
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importResult.soyTemplateName = 'gliffySoy.macro.dialog.importResult';
}


gliffySoy.macro.dialog.importResultItem = function(opt_data, opt_ignored) {
  return '<li class="gliffy-attached-image" data-attachment-id="' + soy.$$escapeHtml(opt_data.attachment.attachmentId) + '" data-name="' + soy.$$escapeHtml(opt_data.attachment.name) + '" data-page-id="' + soy.$$escapeHtml(opt_data.attachment.pageId) + '" data-version="' + soy.$$escapeHtml(opt_data.attachment.version) + '"><div class="gliffy-image-container"><img width="100" height="100" title="' + soy.$$escapeHtml(opt_data.attachment.name) + '" src="' + soy.$$escapeHtml(opt_data.contextPath) + '/rest/gliffy/1.0' + soy.$$escapeHtml(opt_data.attachment.urls.thumbnail) + '" class="thumbnail"/></div><span class="caption filename">' + soy.$$escapeHtml(opt_data.attachment.name) + '</span><span class="caption owner-title">' + soy.$$escapeHtml(opt_data.attachment.lastModifiedFriendly) + '</span></li>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.importResultItem.soyTemplateName = 'gliffySoy.macro.dialog.importResultItem';
}


gliffySoy.macro.dialog.morePropertyPanel = function(opt_data, opt_ignored) {
  var output = '<form action="#" method="post" class="aui top-label" name="gliffy-more-form"><fieldset><div class="field-group"><label for="gliffy-dialog-more-size-field">' + soy.$$escapeHtml("Size") + '</label><input id="gliffy-dialog-more-size-field" name="gliffy-dialog-more-size-field" class="text" type="text" value="' + soy.$$escapeHtml(opt_data.size) + '"/><div id="gliffy-dialog-more-size-error-field" class="error"></div><div class="description">' + soy.$$escapeHtml("Width in #px | T (150px) | S (1:3) | M (2:3) | L (1:1)") + '</div></div><div class="field-group"><label for="gliffy-dialog-more-chrome">' + soy.$$escapeHtml("Viewer Toolbar") + '</label><select name="gliffy-chrome" id="gliffy-dialog-more-chrome-field">';
  var chromeOptionList359 = opt_data.chromeOptions;
  var chromeOptionListLen359 = chromeOptionList359.length;
  for (var chromeOptionIndex359 = 0; chromeOptionIndex359 < chromeOptionListLen359; chromeOptionIndex359++) {
    var chromeOptionData359 = chromeOptionList359[chromeOptionIndex359];
    output += (chromeOptionData359.key == opt_data.selectedChromeOption) ? '<option value="' + soy.$$escapeHtml(chromeOptionData359.key) + '" selected="selected">' + soy.$$escapeHtml(chromeOptionData359.value) + '</option>' : '<option value="' + soy.$$escapeHtml(chromeOptionData359.key) + '">' + soy.$$escapeHtml(chromeOptionData359.value) + '</option>';
  }
  output += '</select><div class="description">' + soy.$$escapeHtml("\x22Full\x22 displays Edit/Zoom controls") + '</div></div>' + ((! opt_data.isHtml5ViewerDisabledByAdmin) ? '<div class="field-group"><input class="gliffy-dialog-interactive-viewer-checkbox" type="checkbox" ' + ((opt_data.html5Viewer == true) ? 'checked' : '') + '/><span>' + soy.$$escapeHtml("Interactive HTML5 Viewer") + '</span><div class="description">' + soy.$$escapeHtml("Fall back to PNG image when disabled") + '</div></div>' : '') + '</fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.morePropertyPanel.soyTemplateName = 'gliffySoy.macro.dialog.morePropertyPanel';
}


gliffySoy.macro.dialog.versionPropertyPanel = function(opt_data, opt_ignored) {
  var output = '<form action="#" method="post" class="aui top-label" name="gliffy-version-form"><fieldset><div class="field-group"><div class="description">' + soy.$$escapeHtml("Select which diagram version to pin to the page.") + '</div><select name="gliffy-version" id="gliffy-dialog-version-field">';
  var versionList393 = opt_data.versions;
  var versionListLen393 = versionList393.length;
  for (var versionIndex393 = 0; versionIndex393 < versionListLen393; versionIndex393++) {
    var versionData393 = versionList393[versionIndex393];
    output += (versionData393.key == opt_data.selectedVersion) ? '<option value="' + soy.$$escapeHtml(versionData393.key) + '" selected="selected">' + soy.$$escapeHtml(versionData393.value) + '</option>' : '<option value="' + soy.$$escapeHtml(versionData393.key) + '">' + soy.$$escapeHtml(versionData393.value) + '</option>';
  }
  output += '</select><div id="gliffy-version-dialog-information" class="description"></div><a id="gliffy-diagram-preview"><img id="gliffy-diagram-thumbnail"></a></div></fieldset></form>';
  return output;
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.versionPropertyPanel.soyTemplateName = 'gliffySoy.macro.dialog.versionPropertyPanel';
}


gliffySoy.macro.dialog.noSaveDialog = function(opt_data, opt_ignored) {
  return '<div>' + soy.$$escapeHtml(opt_data.pageUnsavedMessage) + '</div>';
};
if (goog.DEBUG) {
  gliffySoy.macro.dialog.noSaveDialog.soyTemplateName = 'gliffySoy.macro.dialog.noSaveDialog';
}

} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'js/gliffy-html5-analytics.min.js' */
(function(){(function(c){
/*!! Simple JavaScript Inheritance
     * By John Resig http://ejohn.org/
     * MIT Licensed.
     * http://ejohn.org/blog/simple-javascript-inheritance
     *
     */
var d=false,g=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;var a=function(){};a.extend=function(n){var m=this.prototype;d=true;var l=new this();d=false;for(var k in n){l[k]=typeof n[k]=="function"&&typeof m[k]=="function"&&g.test(n[k])?(function(o,p){return function(){var r=this._super;this._super=m[o];var q=p.apply(this,arguments);this._super=r;return q}})(k,n[k]):n[k]}function j(){if(!(this instanceof j)){return new j(arguments)}if(!d&&this.init){this.init.apply(this,arguments)}}j.prototype=l;j.prototype.constructor=j;j.extend=arguments.callee;return j};var e=a.extend({init:function(){},setAccount:function(){},trackEvent:function(){},trackPageView:function(){},logEvents:function(){},setLabel:function(){},runFuncIfAnalyticsExists:function(){}});var h=a.extend({__eventsRemaining:0,__maxEvents:0,__regenInterval:-1,__functionQueue:null,abort:function(){clearInterval(this.__regenInterval)},init:function(l){var k=c.extend({eventBucket:9,regen:1,per:1100},l),j=this;j.__eventsRemaining=k.eventBucket;j.__maxEvents=k.eventBucket;j.__functionQueue=[];j.__regenInterval=setInterval(function(){j.__eventsRemaining=Math.min(k.eventBucket,j.__eventsRemaining+k.regen);j.__runEvents()},k.per)},__runEvents:function(){var j=this,k;while(j.__eventsRemaining>0&&j.__functionQueue.length>0){k=j.__functionQueue.shift();k.func.apply(this,k.args);j.__eventsRemaining--}},addFunction:function(k,j){this.__functionQueue.push({func:k,args:j});this.__runEvents()}});var f=e.extend({_loaded:false,_trackerID:"",_logEvents:false,_logger:null,_activeLabel:null,_optPageName:null,_eventThrottler:null,_eventWarningCtr:450,_customVariableIndices:null,_canLog:function(){return this._logger!==null&&this._logEvents===true},init:function(m,o,l,k){var n,p=document.createElement("script"),j=this;this._optPageName=o;if(k===undefined){k=false}p.type="text/javascript";p.async=true;p.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/"+(k?"u/ga_debug.js":"ga.js");n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(p,n);this._trackerID=m;this._eventWarningCtr=450;p.onreadystatechange=function(){if(this.readyState==="complete"){j._scriptLoaded();if(l){l()}}};p.onload=function(){j._scriptLoaded();if(l){l()}};j._customVariableIndices={product:1,license:2,numUsers:3};j._eventThrottler=new h()},loaded:function(){return this._loaded},setAccount:function(j){this._push(["_setAccount",j])},setLabel:function(j){this._activeLabel=j},setCustomVariables:function(m,l,j){var k=3;if(m){this._push(["_setCustomVar",this._customVariableIndices.product,"product",m,k])}this._push(["_setCustomVar",this._customVariableIndices.license,"license",l,k]);this._push(["_setCustomVar",this._customVariableIndices.numUsers,"numUsers",j,k])},trackEvent:function(l,m,n,j,k){n=n===undefined?null:n;j=j===undefined?null:j;k===undefined?null:k;if(n===null&&this._activeLabel!==null){n=this._activeLabel}this._push(["_trackEvent",l,m,n,j,k]);if(--this._eventWarningCtr===0){this._push(["_trackEvent","warning","eventsExceed450",n,null,null])}if(l==="lzxclient"){this._push(["_trackPageview","/lzxEvent/"+m])}},trackPageView:function(){if(this._optPageName){this._push(["_set","title",this._optPageName]);this._push(["_trackPageview",this._optPageName])}else{this._push(["_trackPageview"])}},logEvents:function(j,k){this._logEvents=j;this._logger=k},_scriptLoaded:function(){this._loaded=true;this._push(["_setDomainName","none"]);this.setAccount(this._trackerID);this.trackPageView()},_push:function(j){var k=this;this._eventThrottler.addFunction(function(){if(typeof _gaq!="undefined"){if(this._optPageName){_gaq.push(["_set","title",this._optPageName])}_gaq.push(j);if(k._canLog()){k._logger.log("ANALYTICS: "+j.join(", "))}}})},runFuncIfAnalyticsExists:function(j){if(j){j()}}});var b=a.extend({_analytics:null,_queuedEvents:null,init:function(){var j=this;j._queuedEvents=[];c(window).bind("init.gliffyAnalytics",function(l,m){var k=c.extend({},{accountType:"none",accountID:"UA-248648-8",debug:false,optPageName:null},m);if(!j._analytics){switch(k.accountType){case"google":j._analytics=new f(k.accountID,k.optPageName,function(){var n;while(n=j._queuedEvents.shift()){c(window).trigger(n[0]+".gliffyAnalytics",n[1])}},k.debug);break}}});c(window).bind("trackEvent.gliffyAnalytics",function(l,m){var k=c.extend({},{category:"",action:"",label:null,value:null,non_interaction:null},m);if(j._analytics&&j._analytics.loaded()){j._analytics.trackEvent(k.category,k.action,k.label,k.value,k.non_interaction)}else{j._queuedEvents.push(["trackEvent",m])}});c(window).bind("setLabel.gliffyAnalytics",function(l,m){var k=c.extend({},{label:null},m);if(j._analytics&&j._analytics.loaded()){j._analytics.setLabel(k.label)}else{j._queuedEvents.push(["setLabel",m])}});c(window).bind("logEvents.gliffyAnalytics",function(l,m){var k=c.extend({},{logEvents:false,logger:null},m);if(j._analytics&&j._analytics.loaded()){j._analytics.logEvents(k.logEvents,k.logger)}else{j._queuedEvents.push(["logEvents",m])}});c(window).bind("setCustomVariables.gliffyAnalytics",function(l,m){var k=c.extend({},{product:null,license:"none",numUsers:0},m);if(j._analytics&&j._analytics.loaded()){j._analytics.setCustomVariables(k.product,k.license,k.numUsers)}else{j._queuedEvents.push(["setCustomVariables",m])}});c(window).bind("runFuncIfAnalyticsExists.gliffyAnalytics",function(l,m){var k=c.extend({},{func:null},m);if(j._analytics){j._analytics.runFuncIfAnalyticsExists(k.func)}})}});var i=new b()}(jQuery))}());
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'gliffy/confluence/macro/controller/PropertyPanelController.js' */
require("gliffy/amd/apexModuleManager").define("gliffy/confluence/macro/controler/PropertyPanelController",["jquery","GliffySpinner","gliffy/confluence/rest/urlFactory","gliffy/confluence/rest/webRequestPromiseFactory","gliffy/confluence/editor/editorLauncher","gliffy/confluence/pageFacade","gliffy/interface/analytics"],function(f,c,a,k,n,e,l){var g=function(q){AJS.Rte.BookmarkManager.storeBookmark();if(q.params&&q.params.name&&q.params.name.length>0){if(AJS.Meta.get("form-name")==="createpagetemplate"||AJS.Meta.get("form-name")==="editpagetemplate"){var r=new AJS.Dialog({width:450,height:250,id:"gliffy-no-editing-template-message",closeOnOutsideClick:true});r.addHeader("Gliffy in Page Templates").addPanel("SinglePanel","","gliffy-no-editing-template-content");f(".gliffy-no-editing-template-content").html("Gliffy diagrams cannot be edited in page templates.  Please edit the diagram from the page where it is attached and changes will be reflected here.");r.addCancel("Close",function(){r.hide()});r.show()}else{if(q.params.blueprint){AJS.trigger("gliffy.confluence.launchTemplate",[q.params.blueprint,q.params.name])}else{if(q.params.attachmentId){AJS.trigger("gliffy.confluence.launchTemplate",["com.gliffy.transform.diagram",q.params.attachmentId])}else{if(q.params.page&&q.params.name&&!q.params.pageid){if(q.params.space==null){q.params.space=AJS.Meta.get("space-key")}var t=AJS.format("{0}/ceo/find/space/{1}/page/{2}/name/{3}",GLIFFY._confluence.gvars.gliffyApiEndpoint,encodeURIComponent(q.params.space),encodeURIComponent(q.params.page),encodeURIComponent(q.params.name));f.ajax({type:"GET",url:t,dataType:"json",cache:false,success:function(u){n.launchEditorFromEditPage({editor:GLIFFY._confluence.editor,diagramName:q.params.name,ownerPageId:u.id,referencePageId:u.id,attachmentId:u.attachmentId,attachmentVersion:u.attachmentVersion,template:{category:"com.gliffy.diagram"}})},error:function(w,u,v){alert(GLIFFY._confluence.utils.parseError(w))}})}else{if(q.params.pageid==null){q.params.pageid=Confluence.Editor.getContentId()}var s=k.buildGetEditDiagramPermissionPromise(q.params.pageid,q.params.name);f.when(s).done(function(u){var v=parseInt(q.params.version)||0;n.launchEditorFromEditPage({editor:GLIFFY._confluence.editor,diagramName:q.params.name,ownerPageId:q.params.pageid,referencePageId:Confluence.Editor.getContentId(),attachmentVersion:v,attachmentId:u.attachmentId,template:{category:"com.gliffy.diagram"}})}).fail(function(u){alert(GLIFFY._confluence.utils.parseError(u))})}}}}}else{AJS.trigger("gliffy.confluence.showMacroDialog")}};var b=function(q,s){var t=AJS.$(q);AJS.Rte.getEditor().selection.select(t[0]);AJS.Rte.BookmarkManager.storeBookmark();var r=e.getDiagramReference(t);r.size=s;e.addDiagramReference(r,t[0])};var p=function(q){var s=AJS.$(q);AJS.Rte.getEditor().selection.select(s[0]);AJS.Rte.BookmarkManager.storeBookmark();var r=e.getDiagramReference(s);r.border=!r.border;e.addDiagramReference(r,s[0])};var d=function(t){var u=["T","S","M","L","O"];var s=function(y){var x=f.trim(y);if(x.length===0){return""}if(f.inArray(x,u)>=0){return x}var A=parseInt(x);if(isNaN(A)){return false}var z=A>=150&&A<=3000;if(z){return A}return false};var r=f(".gliffy-more-panel").data("diagramReference");var q=f(".gliffy-more-panel").data("macroNode");var w=f("#gliffy-dialog-more-size-field");var v=s(w.val());if(v===false){f("#gliffy-dialog-more-size-error-field").text("Invalid input (150 min, 3000 max)");return false}else{(""===v)?delete r.size:r.size=v}r.chrome=f("#gliffy-dialog-more-chrome-field").val();r.html5=f(".gliffy-dialog-interactive-viewer-checkbox").is(":checked");e.addDiagramReference(r,q);t.remove()};var j=function(q,r){return{size:(q.size==null)?"":q.size,chromeOptions:[{key:"full",value:"Full"},{key:"min",value:"None"}],selectedChromeOption:(q.chrome==null)?"full":q.chrome,html5Viewer:(q.html5===undefined||q.html5===null)?true:q.html5=="true",isHtml5ViewerDisabledByAdmin:r}};var o=function(s,r,q){var t=new AJS.Dialog(340,380,"gliffy-dialog-more");t.addHeader("Additional Options","");t.addPanel("More Panel",gliffySoy.macro.dialog.morePropertyPanel(q),"gliffy-more-panel",0);f(".gliffy-more-panel").data("diagramReference",s).data("macroNode",r);t.addButton("Update",d,"gliffy-more-update");t.addCancel("Cancel",function(u){AJS.Rte.BookmarkManager.restoreBookmark();u.remove()});t.show()};var m=function(q){var t=AJS.$(q);AJS.Rte.getEditor().selection.select(t[0]);AJS.Rte.BookmarkManager.storeBookmark();var s=e.getDiagramReference(t);var r=k.buildGetPropertyValuePromise("com.gliffy.integration.confluence.HTML5_OFF");f.when(r).then(function(v){var u=j(s,!!v);o(s,q,u)})};var i=function(w,u,r){f("#gliffy-version-dialog-information").text("");var s=+f("#gliffy-dialog-version-field").val();var x=w.allVersionInformation[s-1];if(s===0){x=w.allVersionInformation[w.allVersionInformation.length-1]}if(x){f("#gliffy-version-dialog-information").text(x)}f("#gliffy-diagram-preview").attr("href",a.buildDiagramPreviewImageUrl(r,u,s));f("#gliffy-diagram-thumbnail").attr("src",a.buildDiagramThumbnailImageUrl(r,u,s));var q=s;if(s===0){q=w.allVersionInformation.length}var t=f("#gliffy-diagram-thumbnail");if(t.previewer){f(t).previewer({src:f("#gliffy-diagram-preview").attr("href"),type:"image/png",title:"v"+q,zindex:10000}).closest("a").attr("href","#").click(function(v){v.preventDefault()})}else{f("#gliffy-diagram-preview").fancybox({type:"image",showCloseButton:true,hideOnOverlayClick:true,hideOnContentClick:true,title:"v"+q})}};var h=function(v){l.event("trackEvent",{category:"viewer",action:"showVersionPinningDialog"});var q=function(B){if(!f(B.target).closest("#gliffy-version-dialog").length){f(document).off("click",q);x.remove()}};f(document).on("click",q);var u=AJS.$(v);var z=e.getDiagramReference(u);var s=z.ownerPageId;var x=new AJS.Dialog({width:340,height:430,id:"gliffy-version-dialog",closeOnOutsideClick:false});x.addHeader("Version");x.addPanel("Panel 1","<div/>","gliffy-version-body");x.addLink("Cancel",function(B){f(document).off("click",q);B.remove()},"#");x.show();var r=AJS.$("#gliffy-version-dialog");var A=new c(r.get(0),{radius:50,color:"#666"});A.start();var w=k.buildGetDiagramVersionsPromise(s,z.name);var t=function(C){A.stop();var B=[{key:"0",value:"Latest"}];for(var D=C.numRevisions;D>0;D--){B.push({key:""+D,value:"v"+D})}var E={versions:B,selectedVersion:z.version||0,allVersionInformation:C.revisions.map(function(F){return F.lastModifiedFriendly+" by "+F.creator}).reverse()};f(".gliffy-version-body").html(gliffySoy.macro.dialog.versionPropertyPanel(E));x.addButton("Update",function(F){f(document).off("click",q);l.event("trackEvent",{category:"viewer",action:"pinToNewVersion"});var G=f("#gliffy-dialog-version-field").val();z.version=parseInt(G);e.addDiagramReference(z,v);F.remove()});x.gotoPanel(0);i(E,z.name,s);f("#gliffy-dialog-version-field").change(function(){i(E,z.name,s)})};var y=function(D){A.stop();f("#gliffy-version-dialog").remove();if(D.status===404){var B=new AJS.Dialog({width:340,height:190,id:"gliffy-version-dialog",closeOnOutsideClick:true});var C={pageUnsavedMessage:"Sorry, version information is not available until the Confluence page has been saved."};B.addPanel("Diagram Version Selection",gliffySoy.macro.dialog.noSaveDialog(C),"gliffy-version-body");B.addButton("Close",function(E){E.remove()});B.gotoPanel(0);B.show()}};f.when(w).done(t).fail(y)};f("form[name='gliffy-more-form']").live("submit",function(){return false});AJS.bind("created.property-panel",function(t,q){var s=f(q.anchor);if(s.data("macro-name")==="gliffy"){var r=e.getDiagramReference(s);if(r.border){q.panel.find(".macro-property-panel-gliffy-button-image-border").addClass("selected")}if(r.size){switch(r.size){case"300":q.panel.find(".macro-property-panel-gliffy-button-image-small").addClass("selected");break;case"600":q.panel.find(".macro-property-panel-gliffy-button-image-medium").addClass("selected");break;case"1200":q.panel.find(".macro-property-panel-gliffy-button-image-large").addClass("selected");break;default:break}}else{q.panel.find(".macro-property-panel-gliffy-button-image-original").addClass("selected")}}});AJS.MacroBrowser.setMacroJsOverride("gliffy",{opener:g});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-image-small",function(r,q){b(q,"300")});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-image-medium",function(r,q){b(q,"600")});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-image-large",function(r,q){b(q,"1200")});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-image-original",function(r,q){b(q,"O")});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-image-border",function(r,q){p(q)});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-more",function(r,q){m(q)});AJS.Confluence.PropertyPanel.Macro.registerButtonHandler("gliffy-button-version",function(r,q){h(q)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
;try {
/* module-key = 'com.gliffy.integration.confluence:gliffy-rte-html5-resources', location = 'gliffy/confluence/ContextFinalizer.js' */
(function(b,a){b(function(){a.instantiateAll();a.reset()})})(require("jquery"),require("gliffy/amd/apexModuleManager"));
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
