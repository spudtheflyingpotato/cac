;try {
/* module-key = 'com.atlassian.confluence.plugins.confluence-paste:autoconvert-core', location = 'js/autoconvert/tinymce-autoconvert.js' */
define("confluence-paste/autoconvert/tinymce-autoconvert",["tinymce","ajs","jquery","document"],function(k,e,f,n){function l(a){for(var d=l.options,a=d.parser[d.strictMode?"strict":"loose"].exec(a),c={},b=14;b--;)c[d.key[b]]=a[b]||"";c[d.q.name]={};c[d.key[12]].replace(d.q.parser,function(a,b,e){b&&(c[d.q.name][b]=e)});return c}var g=function(a){a.onUndo.add(this.cleanLinks);this.editor=a;this.weightedHandlers=[];this.handlers=[]};g.prototype={addHandler:function(a,d){this.weightedHandlers.push({handler:a,
weight:d||0});this.weightedHandlers.sort(function(a,b){return a.weight-b.weight});this.handlers=[];for(var c=this.weightedHandlers.length,b=0;b<c;b++)this.handlers.push(this.weightedHandlers[b].handler)},cleanLinks:function(a){f("a.atlassian-autoconvert",a.getDoc()).removeClass("atlassian-autoconvert");return!0},callHandlers:function(a){function d(a){if(a&&(1!==a.length||!a.attr("href")))return b(a);if(a)j=a,i=0,m=l(j.attr("href")),c(h.handlers[i],m,j);else if(i++,i<h.handlers.length)c(h.handlers[i],
m,j);else return b(j)}function c(a,b,c){var f=d,g;g=setTimeout(function(){e.log("Autoconvert: Callback #"+i+" failed to call continuation in time. If there is no subsequent log, the handler is improperly implemented and should be uninstalled.");f=function(){e.log("Autoconvert: Callback #"+i+" did eventualy return. Probably a slow async call.")};d()},k.plugins.Autoconvert.callbackTimeout);a(b,c,function(){var a=i;clearTimeout(g);f.apply(h,arguments);f=function(){e.log("Autoconvert: Callback #"+a+" called the continuation multiple times.")}})}
function b(a){h.editor.undoManager.beforeChange();var b=h.editor.selection,c=h.editor.selection.getBookmark();g.replaceWith(a);b.moveToBookmark(c);h.editor.undoManager.add()}var i=0,h=this,g=f(a),j=f(a).clone(),a=j.attr("href"),m=l(a.replace(/^(.*?\/\/[^/]*?\/.*?)(@)/,"$1%40"));0!==this.handlers.length&&c(this.handlers[0],m,j)}};g.callbackTimeout=5E3;g.convertMacroToDom=function(a,d,c){a={macro:a,contentId:e.Meta.get("content-id")};f.ajax({type:"POST",contentType:"application/json; charset=utf-8",
url:e.params.contextPath+"/rest/tinymce/1/macro/placeholder",data:f.toJSON(a),dataType:"text",success:d,error:c,timeout:45E3})};g.convertMacroToDomViaWikiText=function(a,d,c){var b=["{",a.name],e=!0;a.defaultParameterValue&&(b.push(":",a.defaultParameterValue),e=!1);for(var h in a.params)e?(b.push(":"),e=!1):b.push("|"),b.push(h,"=",a.params[h]);b.push("}");g.getHtmlFromWikiMarkup(b.join(""),function(a){d(f(a)[0])},function(){c()})};g.getHtmlFromWikiMarkup=function(a,d,c){a={wiki:a,entityId:e.Meta.get("content-id"),
spaceKey:e.Meta.get("space-key")};f.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:e.params.contextPath+"/rest/tinymce/1/wikixhtmlconverter",data:f.toJSON(a),dataType:"text",success:d,error:c,timeout:45E3})};l.options={strictMode:!1,key:"source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};return{autoConverter:g,plugin:{init:function(a){function d(b,d,e){b=f(e.node).children("a");1===b.length&&("A"===b[0].tagName&&b.text()===b.attr("href"))&&(b.attr("class","atlassian-autoconvert"),setTimeout(function(){var b=f("a.atlassian-autoconvert",f(a.selection.getNode().ownerDocument)).removeClass("atlassian-autoconvert");
c.callHandlers(b)},0))}var c=new g(a);k.plugins.Autoconvert.autoConvert=c;a.onInit.add(function(){f(n).bind("postPaste",d);a.addCommand("addAutoconverter",function(a,d){c.addHandler(d)})});a.onRemove.add(function(){f(n).unbind("postPaste",d)})},getInfo:function(){return{longname:"Atlassian Autoconvert",author:"Atlassian",authorurl:"http://www.atlassian.com",infourl:"http://www.atlassian.com",version:"1.0"}}}}});
require("confluence/module-exporter").safeRequire("confluence-paste/autoconvert/tinymce-autoconvert",function(k){var e=require("tinymce");e.plugins.Autoconvert=k.autoConverter;e.create("tinymce.plugins.AutoconvertPlugin",k.plugin);e.PluginManager.add("autoconvert",e.plugins.AutoconvertPlugin)});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
